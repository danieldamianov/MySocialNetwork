@{
    ViewData["Title"] = "Home Page";
}
@using SocialNetwork.Models.Home
@using System.Security.Claims
@using Microsoft.AspNetCore.Identity
@using SocialNetwork.DatabaseModels
@using SocialNetwork.Models

@inject SignInManager<SocialNetworkUser> SignInManager

@model NewsFeedHomeIndexViewModel

<div class="text-center">
    <h1 class="display-4 text-secondary">Welcome, @Model.Username</h1>
    <br />
    <div>
        <partial name="_LinkToNewPostPage" />
    </div>
    @if (SignInManager.IsSignedIn(this.User))
    {
        @foreach (var post in Model.Posts)
        {
            <div class="col-8" style=" margin-top:100px; border:solid ;border-radius: 25px; border-color:darkgray">
                <div class="text-secondary" align="left">
                    <partial name="_LinkToProfile" model="new LinkToProfileViewModel(post.UserId,post.UserAvatarCode,post.Username,50)" />
                    <h4>@post.Description</h4>
                    <img style="width: 100%;border : 5px solid" src="@post.Code" />
                    <h5>@post.TimeSinceCreated</h5>
                    <br />
                </div>
                <div @*class="col-7"*@>
                    @{
                        var likeOrUnlikeButtonPath = "fas fa-thumbs-down";
                        if (post.HasCurrentUserLikedThePost == false)
                        {
                            likeOrUnlikeButtonPath = "fas fa-thumbs-up";
                        }
                    }


                    <button class="bg-transparent" onclick="userLikedOrUnlikedPost('@(User.FindFirstValue(ClaimTypes.NameIdentifier))','@(post.PostId)')">
                        @*//<img id="@(post.PostId)image" align:left src="@likeOrUnlikeButtonPath" width="50" height="50" />*@
                        <i style="font-size:20px" id="@(post.PostId)image" class="@likeOrUnlikeButtonPath"></i>
                    </button>
                    <div class="dropdown">
                        <button class="dropbtn">
                            <strong id="@(post.PostId)likesCount">@post.UsersLikedThePost.Count</strong>
                            <strong>likes</strong>
                        </button>
                        <div class="dropdown-content">

                            @foreach (var user in post.UsersLikedThePost)
                            {
                                <partial name="_LinkToProfile" model="new LinkToProfileViewModel(user.Id,user.Avatar,user.UserName,40)" />
                            }
                        </div>
                    </div>
                    <button onclick="showCommentsSection('@post.PostId')">
                        <i class="fas fa-comments"></i><strong> @post.Comments.Count </strong>
                    </button>
                </div>


                <button style="margin:5px" onclick="showAddCommentSection('@post.PostId')"><i style="font-size:40px" ; class="fas fa-comment-medical"></i></button>

                <div id="@(post.PostId)addCommentSection" class="col-4" style="margin:10px;display:none">
                    <form action="/Comments/NewComment/?postId=@post.PostId&creatorId=@this.User.FindFirstValue(ClaimTypes.NameIdentifier)" method="post">
                        <div style="margin : 5px">
                            <input width="60" type="text" name="comment" class="form-control" id="comment" style="font-family:sans-serif;font-size:1.2em;">
                        </div>
                        <input class="form-control" type="submit" value="Add Comment  ">
                    </form>
                </div>
                <div style="display:none" id="@(post.PostId)commentsSection" class="col-5">
                    @foreach (var comment in post.Comments)
                    {
                        <partial name="_LinkToProfile" model="new LinkToProfileViewModel(comment.UserId,comment.UserAvatar,comment.Username,40)" />
                        <p style="word-wrap: break-word;">@comment.Content</p>
                    }
                </div>
            </div>
        }
    }
    else
    {
        <h1>
            <a class="text-secondary" href="/Identity/Account/Login">Login</a>,
            or <a class="text-secondary" href="/Identity/Account/Register">Register</a>, if you don't have an account
        </h1>
    }
</div>

@section Scripts
{
    <script src="~/js/Home/index.js"></script>
}

@section Stylesheets
{
    <link href="~/css/Home/index.css" rel="stylesheet" />
}

